<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S2A Dashboard</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <!-- Initial Loading Overlay -->
  <div id="initial-loading" class="initial-loading">
    <div class="loading">
      <div class="spinner"></div>
      <span data-i18n="loading">加载中...</span>
    </div>
  </div>

  <!-- Login Screen -->
  <div id="login-screen" class="login-container">
    <div class="login-card">
      <div class="login-logo">
        <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
      </div>
      <h1 class="login-title" data-i18n="login.title">S2A Dashboard</h1>
      <p class="login-subtitle" data-i18n="login.subtitle">请输入管理密码以继续</p>
      <form id="login-form">
        <div class="input-group">
          <input type="password" id="password-input" data-i18n="login.password.placeholder" placeholder="请输入密码" required>
        </div>
        <button type="submit" class="btn btn-primary">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4M10 17l5-5-5-5M15 12H3"/></svg>
          <span data-i18n="login.button">登录</span>
        </button>
        <p id="login-error" class="error-message hidden"></p>
      </form>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="dashboard">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="header-logo">
          <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
        </div>
        <h1 class="header-title" data-i18n="header.title">S2A Dashboard</h1>
      </div>
      <div class="header-right">
        <div class="lang-selector">
          <select class="lang-select" id="lang-select-header" onchange="setLanguage(this.value)">
            <option value="zh" data-flag="🇨🇳" data-text="🇨🇳 中文">🇨🇳 中文</option>
            <option value="en" data-flag="🇺🇸" data-text="🇺🇸 English">🇺🇸 English</option>
          </select>
        </div>
        <a href="#" id="github-link" target="_blank" rel="noopener noreferrer" class="github-link" data-i18n-title="header.github" title="GitHub Repository">
          <svg viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        </a>
        <button id="logout-btn" class="btn btn-logout" data-i18n-title="header.logout" title="退出登录">
          <svg viewBox="0 0 24 24">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="nav-tabs">
      <button class="nav-tab active" data-tab="overview">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
        <span data-i18n="nav.overview">总览</span>
      </button>
      <button class="nav-tab" data-tab="users">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        <span data-i18n="nav.users">用户管理</span>
      </button>
      <button class="nav-tab" data-tab="apikeys">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
        <span data-i18n="nav.apikeys">API Keys</span>
      </button>
      <button class="nav-tab" data-tab="groups">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
        <span data-i18n="nav.groups">分组配额</span>
      </button>
      <button class="nav-tab" data-tab="subscriptions">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
        <span data-i18n="nav.subscriptions">订阅管理</span>
      </button>
      <button class="nav-tab" data-tab="usage">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10M12 20V4M6 20v-6"/></svg>
        <span data-i18n="nav.usage">使用统计</span>
      </button>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Overview Tab -->
      <div id="tab-overview" class="tab-content active">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-icon pink">
                <svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
              </div>
            </div>
            <div class="stat-value" id="stat-total-users">-</div>
            <div class="stat-label" data-i18n="stat.total_users">总用户数</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-icon green">
                <svg viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><polyline points="17,11 19,13 23,9"/></svg>
              </div>
            </div>
            <div class="stat-value" id="stat-active-users">-</div>
            <div class="stat-label" data-i18n="stat.active_users">活跃用户</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-icon blue">
                <svg viewBox="0 0 24 24"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
              </div>
            </div>
            <div class="stat-value" id="stat-api-keys">-</div>
            <div class="stat-label" data-i18n="stat.api_keys">API Keys</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-icon purple">
                <svg viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
              </div>
            </div>
            <div class="stat-value" id="stat-groups">-</div>
            <div class="stat-label" data-i18n="stat.groups">分组数量</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-icon cyan">
                <svg viewBox="0 0 24 24"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
              </div>
            </div>
            <div class="stat-value" id="stat-subscriptions">-</div>
            <div class="stat-label" data-i18n="stat.subscriptions">活跃订阅</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-icon yellow">
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
              </div>
            </div>
            <div class="stat-value" id="stat-requests-24h">-</div>
            <div class="stat-label" data-i18n="stat.requests_24h">24h 请求数</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-icon orange">
                <svg viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2M12 19v4M8 23h8"/></svg>
              </div>
            </div>
            <div class="stat-value" id="stat-balance">-</div>
            <div class="stat-label" data-i18n="stat.balance">总配额 (USD)</div>
          </div>
        </div>

        <div class="charts-grid">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title" data-i18n="chart.daily_trend">近7天使用趋势</h3>
            </div>
            <div id="daily-stats-container">
              <div class="loading"><div class="spinner"></div> <span data-i18n="loading">加载中...</span></div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h3 class="card-title" data-i18n="chart.model_distribution">模型使用分布</h3>
            </div>
            <div id="model-stats-container">
              <div class="loading"><div class="spinner"></div> <span data-i18n="loading">加载中...</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Users Tab -->
      <div id="tab-users" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="users.title">用户列表</h3>
            <input type="text" class="search-input" id="users-search" data-i18n="users.search" placeholder="搜索邮箱或用户名...">
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th data-i18n="users.id">ID</th>
                  <th data-i18n="users.email">邮箱</th>
                  <th data-i18n="users.username">用户名</th>
                  <th data-i18n="users.role">角色</th>
                  <th data-i18n="users.balance">余额</th>
                  <th data-i18n="users.api_keys">API Keys</th>
                  <th data-i18n="users.subscriptions">订阅</th>
                  <th data-i18n="users.status">状态</th>
                  <th data-i18n="users.created_at">注册时间</th>
                </tr>
              </thead>
              <tbody id="users-table-body">
                <tr><td colspan="9" class="loading"><div class="spinner"></div> <span data-i18n="loading">加载中...</span></td></tr>
              </tbody>
            </table>
          </div>
          <div id="users-pagination" class="pagination"></div>
        </div>
      </div>

      <!-- API Keys Tab -->
      <div id="tab-apikeys" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="apikeys.title">API Keys 列表</h3>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th data-i18n="apikeys.rank">24h排名</th>
                  <th data-i18n="apikeys.name">名称</th>
                  <th data-i18n="apikeys.key">Key</th>
                  <th data-i18n="apikeys.user">用户</th>
                  <th data-i18n="apikeys.group">分组</th>
                  <th data-i18n="apikeys.requests_24h">24h请求</th>
                  <th data-i18n="apikeys.cost_24h">24h消费</th>
                  <th data-i18n="apikeys.cost_7d">7天消费</th>
                  <th data-i18n="apikeys.cost_total">总消费</th>
                  <th data-i18n="apikeys.total_tokens">总Token</th>
                  <th data-i18n="apikeys.last_used">最后使用</th>
                  <th data-i18n="apikeys.status">状态</th>
                </tr>
              </thead>
              <tbody id="apikeys-table-body">
                <tr><td colspan="12" class="loading"><div class="spinner"></div> <span data-i18n="loading">加载中...</span></td></tr>
              </tbody>
            </table>
          </div>
          <div id="apikeys-pagination" class="pagination"></div>
        </div>
      </div>

      <!-- Groups Tab -->
      <div id="tab-groups" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="groups.title">分组配额管理</h3>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th data-i18n="groups.id">ID</th>
                  <th data-i18n="groups.name">名称</th>
                  <th data-i18n="groups.platform">平台</th>
                  <th data-i18n="groups.subscription_type">订阅类型</th>
                  <th data-i18n="groups.rate_multiplier">费率倍率</th>
                  <th data-i18n="groups.daily_limit">日配额</th>
                  <th data-i18n="groups.weekly_limit">周配额</th>
                  <th data-i18n="groups.monthly_limit">月配额</th>
                  <th data-i18n="groups.api_keys">API Keys</th>
                  <th data-i18n="groups.subscriptions">订阅数</th>
                  <th data-i18n="groups.status">状态</th>
                </tr>
              </thead>
              <tbody id="groups-table-body">
                <tr><td colspan="11" class="loading"><div class="spinner"></div> <span data-i18n="loading">加载中...</span></td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Subscriptions Tab -->
      <div id="tab-subscriptions" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="subscriptions.title">订阅与配额使用</h3>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th data-i18n="subscriptions.user">用户</th>
                  <th data-i18n="subscriptions.group">分组</th>
                  <th data-i18n="subscriptions.daily_usage">日配额使用</th>
                  <th data-i18n="subscriptions.weekly_usage">周配额使用</th>
                  <th data-i18n="subscriptions.monthly_usage">月配额使用</th>
                  <th data-i18n="subscriptions.validity">有效期</th>
                  <th data-i18n="subscriptions.status">状态</th>
                </tr>
              </thead>
              <tbody id="subscriptions-table-body">
                <tr><td colspan="7" class="loading"><div class="spinner"></div> <span data-i18n="loading">加载中...</span></td></tr>
              </tbody>
            </table>
          </div>
          <div id="subscriptions-pagination" class="pagination"></div>
        </div>
      </div>

      <!-- Usage Tab -->
      <div id="tab-usage" class="tab-content">
        <div class="stats-grid">
          <div class="card" style="grid-column: span 2;">
            <div class="card-header">
              <h3 class="card-title" data-i18n="usage.top_users">Top 10 用户 (7天)</h3>
            </div>
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th data-i18n="usage.top_users.user">用户</th>
                    <th data-i18n="usage.top_users.requests">请求数</th>
                    <th data-i18n="usage.top_users.cost">总消费 (USD)</th>
                  </tr>
                </thead>
                <tbody id="top-users-table-body">
                  <tr><td colspan="3" class="loading"><div class="spinner"></div> <span data-i18n="loading">加载中...</span></td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="usage.recent">最近请求记录</h3>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th data-i18n="usage.recent.id">ID</th>
                  <th data-i18n="usage.recent.api_key">API Key</th>
                  <th data-i18n="usage.recent.user">用户</th>
                  <th data-i18n="usage.recent.model">模型</th>
                  <th data-i18n="usage.recent.input_tokens">输入Token</th>
                  <th data-i18n="usage.recent.output_tokens">输出Token</th>
                  <th data-i18n="usage.recent.cost">消费</th>
                  <th data-i18n="usage.recent.duration">耗时</th>
                  <th data-i18n="usage.recent.time">时间</th>
                </tr>
              </thead>
              <tbody id="recent-usage-table-body">
                <tr><td colspan="9" class="loading"><div class="spinner"></div> <span data-i18n="loading">加载中...</span></td></tr>
              </tbody>
            </table>
          </div>
          <div id="recent-usage-pagination" class="pagination"></div>
        </div>
      </div>
    </main>
  </div>

  <script src="/app.js"></script>
</body>
</html>
