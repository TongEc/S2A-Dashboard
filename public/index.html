<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S2A Dashboard</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #fafbfc;
      --bg-card: #ffffff;
      --text-primary: #1a1a2e;
      --text-secondary: #6b7280;
      --text-muted: #9ca3af;

      /* Candy colors */
      --candy-pink: #ff6b9d;
      --candy-purple: #c084fc;
      --candy-blue: #60a5fa;
      --candy-cyan: #22d3ee;
      --candy-green: #4ade80;
      --candy-yellow: #fbbf24;
      --candy-orange: #fb923c;
      --candy-red: #f87171;

      /* Shadows */
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.06);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03);
      --shadow-lg: 0 10px 25px -5px rgba(0,0,0,0.05), 0 8px 10px -6px rgba(0,0,0,0.02);
      --shadow-glow-pink: 0 0 20px rgba(255,107,157,0.3);
      --shadow-glow-blue: 0 0 20px rgba(96,165,250,0.3);
      --shadow-glow-purple: 0 0 20px rgba(192,132,252,0.3);
      --shadow-glow-green: 0 0 20px rgba(74,222,128,0.3);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
    }

    /* Login Screen */
    .login-container {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }

    .login-card {
      background: var(--bg-card);
      padding: 48px;
      border-radius: 24px;
      box-shadow: var(--shadow-lg);
      width: 100%;
      max-width: 400px;
      text-align: center;
    }

    .login-logo {
      width: 72px;
      height: 72px;
      background: #ffa0a0;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
      box-shadow: var(--shadow-glow-pink);
    }

    .login-logo svg {
      width: 40px;
      height: 40px;
      fill: white;
    }

    .login-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .login-subtitle {
      color: var(--text-secondary);
      margin-bottom: 32px;
    }

    .input-group {
      margin-bottom: 24px;
    }

    .input-group input {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.2s;
      background: var(--bg-primary);
    }

    .input-group input:focus {
      outline: none;
      border-color: var(--candy-purple);
      box-shadow: 0 0 0 4px rgba(192,132,252,0.1);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px 28px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ff9cbd, #ffaa96);
      color: white;
      width: 100%;
      box-shadow: var(--shadow-md), var(--shadow-glow-pink);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg), 0 0 30px rgba(255,107,157,0.4);
    }

    .error-message {
      color: var(--candy-red);
      font-size: 14px;
      margin-top: 12px;
    }

    /* Dashboard Layout */
    .dashboard {
      display: none;
    }

    .dashboard.active {
      display: block;
    }

    .header {
      background: var(--bg-card);
      padding: 16px 32px;
      box-shadow: var(--shadow-md);
      border-bottom: 2px solid #f3f4f6;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .header-logo {
      width: 40px;
      height: 40px;
      background: #ffa0a0;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-glow-pink);
    }

    .header-logo svg {
      width: 24px;
      height: 24px;
      fill: white;
    }

    .header-title {
      font-size: 20px;
      font-weight: 600;
    }

    .btn-logout {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: var(--bg-primary);
      color: var(--text-secondary);
      padding: 0;
      transition: all 0.2s;
    }

    .btn-logout:hover {
      background: #f3f4f6;
      color: var(--text-primary);
      transform: translateY(-2px);
    }

    .btn-logout svg {
      width: 20px;
      height: 20px;
      fill: none;
      stroke: currentColor;
      stroke-width: 2;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .github-link {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: var(--bg-primary);
      color: var(--text-secondary);
      transition: all 0.2s;
      text-decoration: none;
    }

    .github-link:hover {
      background: #f3f4f6;
      color: var(--text-primary);
      transform: translateY(-2px);
    }

    .github-link svg {
      width: 22px;
      height: 22px;
      fill: currentColor;
    }

    /* Navigation */
    .nav-tabs {
      display: flex;
      gap: 8px;
      padding: 20px 32px;
      background: var(--bg-card);
      border-bottom: 1px solid #f3f4f6;
      overflow-x: auto;
    }

    .nav-tab {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 10px;
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      transition: all 0.2s;
      white-space: nowrap;
    }

    .nav-tab:hover {
      background: var(--bg-primary);
      color: var(--text-primary);
    }

    .nav-tab.active {
      background: linear-gradient(135deg, #ff9cbd, #ffaa96);
      color: white;
      box-shadow: var(--shadow-md), var(--shadow-glow-pink);
    }

    .nav-tab svg {
      width: 18px;
      height: 18px;
    }

    /* Main Content */
    .main-content {
      padding: 32px;
      max-width: 1600px;
      margin: 0 auto;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--bg-card);
      padding: 24px;
      border-radius: 16px;
      box-shadow: var(--shadow-md);
      transition: all 0.3s;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .stat-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .stat-icon svg {
      width: 24px;
      height: 24px;
      fill: white;
    }

    .stat-icon.pink { background: linear-gradient(135deg, var(--candy-pink), #ff8fab); box-shadow: var(--shadow-glow-pink); }
    .stat-icon.blue { background: linear-gradient(135deg, var(--candy-blue), #93c5fd); box-shadow: var(--shadow-glow-blue); }
    .stat-icon.purple { background: linear-gradient(135deg, var(--candy-purple), #d8b4fe); box-shadow: var(--shadow-glow-purple); }
    .stat-icon.green { background: linear-gradient(135deg, var(--candy-green), #86efac); box-shadow: var(--shadow-glow-green); }
    .stat-icon.cyan { background: linear-gradient(135deg, var(--candy-cyan), #67e8f9); }
    .stat-icon.yellow { background: linear-gradient(135deg, var(--candy-yellow), #fcd34d); }
    .stat-icon.orange { background: linear-gradient(135deg, var(--candy-orange), #fdba74); }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 14px;
      color: var(--text-secondary);
    }

    /* Tables */
    .card {
      background: var(--bg-card);
      border-radius: 16px;
      box-shadow: var(--shadow-md);
      overflow: hidden;
      margin-bottom: 24px;
    }

    .card-header {
      padding: 20px 24px;
      border-bottom: 1px solid #f3f4f6;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
    }

    .search-input {
      padding: 10px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      font-size: 14px;
      width: 260px;
      background: var(--bg-primary);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--candy-purple);
    }

    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th {
      text-align: left;
      padding: 14px 20px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      background: var(--bg-primary);
      border-bottom: 1px solid #e5e7eb;
    }

    td {
      padding: 16px 20px;
      font-size: 14px;
      border-bottom: 1px solid #f3f4f6;
    }

    tr:hover {
      background: #fafbfc;
    }

    .badge {
      display: inline-flex;
      flex-direction: row;
      align-items: center;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      white-space: nowrap;
    }

    .badge-active {
      background: rgba(74,222,128,0.15);
      color: #16a34a;
    }

    .badge-disabled {
      background: rgba(248,113,113,0.15);
      color: #dc2626;
    }

    .badge-expired {
      background: rgba(156,163,175,0.15);
      color: #6b7280;
    }

    .badge-admin {
      background: rgba(192,132,252,0.15);
      color: #9333ea;
    }

    .badge-user {
      background: rgba(96,165,250,0.15);
      color: #2563eb;
    }

    /* Progress Bars */
    .progress-bar {
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 8px;
    }

    .progress-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.3s;
    }

    .progress-fill.low { background: linear-gradient(90deg, var(--candy-green), #86efac); }
    .progress-fill.medium { background: linear-gradient(90deg, var(--candy-yellow), #fcd34d); }
    .progress-fill.high { background: linear-gradient(90deg, var(--candy-orange), #fdba74); }
    .progress-fill.critical { background: linear-gradient(90deg, var(--candy-red), #fca5a5); }

    /* Pagination */
    .pagination {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 20px;
    }

    .page-btn {
      width: 36px;
      height: 36px;
      border: none;
      border-radius: 8px;
      background: var(--bg-primary);
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .page-btn:hover:not(:disabled) {
      background: #e5e7eb;
      color: var(--text-primary);
    }

    .page-btn.active {
      background: linear-gradient(135deg, #ff9cbd, #ffaa96);
      color: white;
      box-shadow: var(--shadow-md), var(--shadow-glow-pink);
    }

    .page-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .page-info {
      color: var(--text-secondary);
      font-size: 14px;
      margin: 0 16px;
    }

    /* Charts placeholder */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 24px;
    }

    .chart-card {
      background: var(--bg-card);
      border-radius: 16px;
      box-shadow: var(--shadow-md);
      padding: 24px;
    }

    .chart-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 20px;
    }

    /* Usage list items */
    .usage-item {
      display: flex;
      align-items: center;
      padding: 16px 24px;
      border-bottom: 1px solid #f3f4f6;
    }

    .usage-item:last-child {
      border-bottom: none;
    }

    .usage-model {
      font-weight: 500;
      color: var(--text-primary);
      min-width: 180px;
    }

    .usage-tokens {
      color: var(--text-secondary);
      font-size: 13px;
      min-width: 140px;
      text-align: center;
    }

    .usage-cost {
      font-weight: 600;
      color: var(--candy-purple);
      min-width: 100px;
      margin-left: auto;
      text-align: right;
    }

    .usage-time {
      color: var(--text-muted);
      font-size: 13px;
      margin-left: auto;
    }

    /* Model stats specific widths */
    #model-stats-container .usage-model {
      flex: 0 0 40%;
      max-width: 40%;
      min-width: 0;
    }

    #model-stats-container .usage-tokens {
      flex: 0 0 25%;
      max-width: 25%;
      min-width: 0;
      text-align: left;
    }

    #model-stats-container .usage-cost {
      flex: 0 0 35%;
      max-width: 35%;
      min-width: 0;
      margin-left: 0;
    }

    /* Loading state */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 60px;
      color: var(--text-secondary);
    }

    .spinner {
      width: 32px;
      height: 32px;
      min-width: 32px;
      min-height: 32px;
      border: 3px solid #e5e7eb;
      border-top-color: var(--candy-purple);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 12px;
      flex-shrink: 0;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .empty-state svg {
      width: 64px;
      height: 64px;
      fill: #e5e7eb;
      margin-bottom: 16px;
    }

    /* Quota cards */
    .quota-info {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .quota-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 13px;
    }

    .quota-label {
      color: var(--text-secondary);
    }

    .quota-value {
      font-weight: 500;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .main-content {
        padding: 16px;
      }

      .header {
        padding: 12px 16px;
        box-shadow: var(--shadow-md);
      }

      .header-left {
        gap: 10px;
      }

      .header-logo {
        width: 36px;
        height: 36px;
        border-radius: 8px;
      }

      .header-logo svg {
        width: 20px;
        height: 20px;
      }

      .header-title {
        display: block;
        font-size: 15px;
        font-weight: 600;
      }

      .header-right {
        gap: 10px;
      }

      .lang-select {
        width: auto;
        min-width: unset;
        padding: 8px 24px 8px 8px;
        font-size: 16px;
        height: 36px;
        line-height: 1;
        background-position: right 6px center;
      }

      .lang-select option {
        font-size: 15px;
      }

      .github-link {
        width: 36px;
        height: 36px;
      }

      .github-link svg {
        width: 18px;
        height: 18px;
      }

      .btn-logout {
        width: 36px;
        height: 36px;
      }

      .btn-logout svg {
        width: 18px;
        height: 18px;
      }

      .nav-tabs {
        padding: 12px 16px;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }

      .stat-card {
        padding: 16px;
      }

      .stat-value {
        font-size: 24px;
      }

      .charts-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Hidden class */
    .hidden {
      display: none !important;
    }

    /* Initial loading overlay */
    .initial-loading {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.3s ease;
    }

    .initial-loading.fade-out {
      opacity: 0;
      pointer-events: none;
    }

    /* Language Selector */
    .lang-selector {
      position: relative;
    }

    .lang-select {
      padding: 10px 28px 10px 10px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      background: var(--bg-primary);
      color: var(--text-primary);
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      line-height: 1;
      transition: all 0.2s;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 8px center;
      min-width: unset;
      width: auto;
      height: 40px;
      display: inline-flex;
      align-items: center;
    }

    .lang-select:hover {
      border-color: var(--candy-purple);
      background-color: white;
      transform: translateY(-1px);
    }

    .lang-select:focus {
      outline: none;
      border-color: var(--candy-purple);
      box-shadow: 0 0 0 3px rgba(192,132,252,0.1);
    }

    .lang-select option {
      padding: 8px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <!-- Initial Loading Overlay -->
  <div id="initial-loading" class="initial-loading">
    <div class="loading">
      <div class="spinner"></div>
      <span data-i18n="loading">åŠ è½½ä¸­...</span>
    </div>
  </div>

  <!-- Login Screen -->
  <div id="login-screen" class="login-container">
    <div class="login-card">
      <div class="login-logo">
        <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
      </div>
      <h1 class="login-title" data-i18n="login.title">S2A Dashboard</h1>
      <p class="login-subtitle" data-i18n="login.subtitle">è¯·è¾“å…¥ç®¡ç†å¯†ç ä»¥ç»§ç»­</p>
      <form id="login-form">
        <div class="input-group">
          <input type="password" id="password-input" data-i18n="login.password.placeholder" placeholder="è¯·è¾“å…¥å¯†ç " required>
        </div>
        <button type="submit" class="btn btn-primary">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4M10 17l5-5-5-5M15 12H3"/></svg>
          <span data-i18n="login.button">ç™»å½•</span>
        </button>
        <p id="login-error" class="error-message hidden"></p>
      </form>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="dashboard">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="header-logo">
          <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
        </div>
        <h1 class="header-title" data-i18n="header.title">S2A Dashboard</h1>
      </div>
      <div class="header-right">
        <div class="lang-selector">
          <select class="lang-select" id="lang-select-header" onchange="setLanguage(this.value)">
            <option value="zh" data-flag="ğŸ‡¨ğŸ‡³" data-text="ğŸ‡¨ğŸ‡³ ä¸­æ–‡">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
            <option value="en" data-flag="ğŸ‡ºğŸ‡¸" data-text="ğŸ‡ºğŸ‡¸ English">ğŸ‡ºğŸ‡¸ English</option>
          </select>
        </div>
        <a href="#" id="github-link" target="_blank" rel="noopener noreferrer" class="github-link" data-i18n-title="header.github" title="GitHub Repository">
          <svg viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        </a>
        <button id="logout-btn" class="btn btn-logout" data-i18n-title="header.logout" title="é€€å‡ºç™»å½•">
          <svg viewBox="0 0 24 24">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="nav-tabs">
      <button class="nav-tab active" data-tab="overview">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
        <span data-i18n="nav.overview">æ€»è§ˆ</span>
      </button>
      <button class="nav-tab" data-tab="users">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        <span data-i18n="nav.users">ç”¨æˆ·ç®¡ç†</span>
      </button>
      <button class="nav-tab" data-tab="apikeys">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
        <span data-i18n="nav.apikeys">API Keys</span>
      </button>
      <button class="nav-tab" data-tab="groups">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
        <span data-i18n="nav.groups">åˆ†ç»„é…é¢</span>
      </button>
      <button class="nav-tab" data-tab="subscriptions">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
        <span data-i18n="nav.subscriptions">è®¢é˜…ç®¡ç†</span>
      </button>
      <button class="nav-tab" data-tab="usage">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 20V10M12 20V4M6 20v-6"/></svg>
        <span data-i18n="nav.usage">ä½¿ç”¨ç»Ÿè®¡</span>
      </button>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Overview Tab -->
      <div id="tab-overview" class="tab-content active">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-icon pink">
                <svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
              </div>
            </div>
            <div class="stat-value" id="stat-total-users">-</div>
            <div class="stat-label" data-i18n="stat.total_users">æ€»ç”¨æˆ·æ•°</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-icon green">
                <svg viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><polyline points="17,11 19,13 23,9"/></svg>
              </div>
            </div>
            <div class="stat-value" id="stat-active-users">-</div>
            <div class="stat-label" data-i18n="stat.active_users">æ´»è·ƒç”¨æˆ·</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-icon blue">
                <svg viewBox="0 0 24 24"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
              </div>
            </div>
            <div class="stat-value" id="stat-api-keys">-</div>
            <div class="stat-label" data-i18n="stat.api_keys">API Keys</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-icon purple">
                <svg viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
              </div>
            </div>
            <div class="stat-value" id="stat-groups">-</div>
            <div class="stat-label" data-i18n="stat.groups">åˆ†ç»„æ•°é‡</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-icon cyan">
                <svg viewBox="0 0 24 24"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
              </div>
            </div>
            <div class="stat-value" id="stat-subscriptions">-</div>
            <div class="stat-label" data-i18n="stat.subscriptions">æ´»è·ƒè®¢é˜…</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-icon yellow">
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
              </div>
            </div>
            <div class="stat-value" id="stat-requests-24h">-</div>
            <div class="stat-label" data-i18n="stat.requests_24h">24h è¯·æ±‚æ•°</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-header">
              <div class="stat-icon orange">
                <svg viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2M12 19v4M8 23h8"/></svg>
              </div>
            </div>
            <div class="stat-value" id="stat-balance">-</div>
            <div class="stat-label" data-i18n="stat.balance">æ€»é…é¢ (USD)</div>
          </div>
        </div>

        <div class="charts-grid">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title" data-i18n="chart.daily_trend">è¿‘7å¤©ä½¿ç”¨è¶‹åŠ¿</h3>
            </div>
            <div id="daily-stats-container">
              <div class="loading"><div class="spinner"></div> <span data-i18n="loading">åŠ è½½ä¸­...</span></div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <h3 class="card-title" data-i18n="chart.model_distribution">æ¨¡å‹ä½¿ç”¨åˆ†å¸ƒ</h3>
            </div>
            <div id="model-stats-container">
              <div class="loading"><div class="spinner"></div> <span data-i18n="loading">åŠ è½½ä¸­...</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Users Tab -->
      <div id="tab-users" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="users.title">ç”¨æˆ·åˆ—è¡¨</h3>
            <input type="text" class="search-input" id="users-search" data-i18n="users.search" placeholder="æœç´¢é‚®ç®±æˆ–ç”¨æˆ·å...">
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th data-i18n="users.id">ID</th>
                  <th data-i18n="users.email">é‚®ç®±</th>
                  <th data-i18n="users.username">ç”¨æˆ·å</th>
                  <th data-i18n="users.role">è§’è‰²</th>
                  <th data-i18n="users.balance">ä½™é¢</th>
                  <th data-i18n="users.api_keys">API Keys</th>
                  <th data-i18n="users.subscriptions">è®¢é˜…</th>
                  <th data-i18n="users.status">çŠ¶æ€</th>
                  <th data-i18n="users.created_at">æ³¨å†Œæ—¶é—´</th>
                </tr>
              </thead>
              <tbody id="users-table-body">
                <tr><td colspan="9" class="loading"><div class="spinner"></div> <span data-i18n="loading">åŠ è½½ä¸­...</span></td></tr>
              </tbody>
            </table>
          </div>
          <div id="users-pagination" class="pagination"></div>
        </div>
      </div>

      <!-- API Keys Tab -->
      <div id="tab-apikeys" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="apikeys.title">API Keys åˆ—è¡¨</h3>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th data-i18n="apikeys.rank">24hæ’å</th>
                  <th data-i18n="apikeys.name">åç§°</th>
                  <th data-i18n="apikeys.key">Key</th>
                  <th data-i18n="apikeys.user">ç”¨æˆ·</th>
                  <th data-i18n="apikeys.group">åˆ†ç»„</th>
                  <th data-i18n="apikeys.requests_24h">24hè¯·æ±‚</th>
                  <th data-i18n="apikeys.cost_24h">24hæ¶ˆè´¹</th>
                  <th data-i18n="apikeys.cost_7d">7å¤©æ¶ˆè´¹</th>
                  <th data-i18n="apikeys.cost_total">æ€»æ¶ˆè´¹</th>
                  <th data-i18n="apikeys.total_tokens">æ€»Token</th>
                  <th data-i18n="apikeys.last_used">æœ€åä½¿ç”¨</th>
                  <th data-i18n="apikeys.status">çŠ¶æ€</th>
                </tr>
              </thead>
              <tbody id="apikeys-table-body">
                <tr><td colspan="12" class="loading"><div class="spinner"></div> <span data-i18n="loading">åŠ è½½ä¸­...</span></td></tr>
              </tbody>
            </table>
          </div>
          <div id="apikeys-pagination" class="pagination"></div>
        </div>
      </div>

      <!-- Groups Tab -->
      <div id="tab-groups" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="groups.title">åˆ†ç»„é…é¢ç®¡ç†</h3>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th data-i18n="groups.id">ID</th>
                  <th data-i18n="groups.name">åç§°</th>
                  <th data-i18n="groups.platform">å¹³å°</th>
                  <th data-i18n="groups.subscription_type">è®¢é˜…ç±»å‹</th>
                  <th data-i18n="groups.rate_multiplier">è´¹ç‡å€ç‡</th>
                  <th data-i18n="groups.daily_limit">æ—¥é…é¢</th>
                  <th data-i18n="groups.weekly_limit">å‘¨é…é¢</th>
                  <th data-i18n="groups.monthly_limit">æœˆé…é¢</th>
                  <th data-i18n="groups.api_keys">API Keys</th>
                  <th data-i18n="groups.subscriptions">è®¢é˜…æ•°</th>
                  <th data-i18n="groups.status">çŠ¶æ€</th>
                </tr>
              </thead>
              <tbody id="groups-table-body">
                <tr><td colspan="11" class="loading"><div class="spinner"></div> <span data-i18n="loading">åŠ è½½ä¸­...</span></td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Subscriptions Tab -->
      <div id="tab-subscriptions" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="subscriptions.title">è®¢é˜…ä¸é…é¢ä½¿ç”¨</h3>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th data-i18n="subscriptions.user">ç”¨æˆ·</th>
                  <th data-i18n="subscriptions.group">åˆ†ç»„</th>
                  <th data-i18n="subscriptions.daily_usage">æ—¥é…é¢ä½¿ç”¨</th>
                  <th data-i18n="subscriptions.weekly_usage">å‘¨é…é¢ä½¿ç”¨</th>
                  <th data-i18n="subscriptions.monthly_usage">æœˆé…é¢ä½¿ç”¨</th>
                  <th data-i18n="subscriptions.validity">æœ‰æ•ˆæœŸ</th>
                  <th data-i18n="subscriptions.status">çŠ¶æ€</th>
                </tr>
              </thead>
              <tbody id="subscriptions-table-body">
                <tr><td colspan="7" class="loading"><div class="spinner"></div> <span data-i18n="loading">åŠ è½½ä¸­...</span></td></tr>
              </tbody>
            </table>
          </div>
          <div id="subscriptions-pagination" class="pagination"></div>
        </div>
      </div>

      <!-- Usage Tab -->
      <div id="tab-usage" class="tab-content">
        <div class="stats-grid">
          <div class="card" style="grid-column: span 2;">
            <div class="card-header">
              <h3 class="card-title" data-i18n="usage.top_users">Top 10 ç”¨æˆ· (7å¤©)</h3>
            </div>
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th data-i18n="usage.top_users.user">ç”¨æˆ·</th>
                    <th data-i18n="usage.top_users.requests">è¯·æ±‚æ•°</th>
                    <th data-i18n="usage.top_users.cost">æ€»æ¶ˆè´¹ (USD)</th>
                  </tr>
                </thead>
                <tbody id="top-users-table-body">
                  <tr><td colspan="3" class="loading"><div class="spinner"></div> <span data-i18n="loading">åŠ è½½ä¸­...</span></td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title" data-i18n="usage.recent">æœ€è¿‘è¯·æ±‚è®°å½•</h3>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th data-i18n="usage.recent.id">ID</th>
                  <th data-i18n="usage.recent.api_key">API Key</th>
                  <th data-i18n="usage.recent.user">ç”¨æˆ·</th>
                  <th data-i18n="usage.recent.model">æ¨¡å‹</th>
                  <th data-i18n="usage.recent.input_tokens">è¾“å…¥Token</th>
                  <th data-i18n="usage.recent.output_tokens">è¾“å‡ºToken</th>
                  <th data-i18n="usage.recent.cost">æ¶ˆè´¹</th>
                  <th data-i18n="usage.recent.duration">è€—æ—¶</th>
                  <th data-i18n="usage.recent.time">æ—¶é—´</th>
                </tr>
              </thead>
              <tbody id="recent-usage-table-body">
                <tr><td colspan="9" class="loading"><div class="spinner"></div> <span data-i18n="loading">åŠ è½½ä¸­...</span></td></tr>
              </tbody>
            </table>
          </div>
          <div id="recent-usage-pagination" class="pagination"></div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // ===== Configuration =====
    const config = {
      siteName: 'S2A Dashboard',
      githubUrl: 'https://github.com/TongEc/s2a-dashboard'
    };

    // ===== i18n System =====
    const translations = {
      zh: {
        // Login
        'login.title': 'S2A Dashboard',
        'login.subtitle': 'è¯·è¾“å…¥ç®¡ç†å¯†ç ä»¥ç»§ç»­',
        'login.password.placeholder': 'è¯·è¾“å…¥å¯†ç ',
        'login.button': 'ç™»å½•',
        'login.error.wrong': 'å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•',
        'login.error.network': 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥',

        // Header
        'header.title': 'S2A Dashboard',
        'header.logout': 'é€€å‡ºç™»å½•',
        'header.github': 'GitHub Repository',

        // Navigation
        'nav.overview': 'æ€»è§ˆ',
        'nav.users': 'ç”¨æˆ·ç®¡ç†',
        'nav.apikeys': 'API Keys',
        'nav.groups': 'åˆ†ç»„é…é¢',
        'nav.subscriptions': 'è®¢é˜…ç®¡ç†',
        'nav.usage': 'ä½¿ç”¨ç»Ÿè®¡',

        // Overview Stats
        'stat.total_users': 'æ€»ç”¨æˆ·æ•°',
        'stat.active_users': 'æ´»è·ƒç”¨æˆ·',
        'stat.api_keys': 'API Keys',
        'stat.groups': 'åˆ†ç»„æ•°é‡',
        'stat.subscriptions': 'æ´»è·ƒè®¢é˜…',
        'stat.requests_24h': '24h è¯·æ±‚æ•°',
        'stat.balance': 'æ€»é…é¢ (USD)',

        // Overview Charts
        'chart.daily_trend': 'è¿‘7å¤©ä½¿ç”¨è¶‹åŠ¿',
        'chart.model_distribution': 'æ¨¡å‹ä½¿ç”¨åˆ†å¸ƒ',
        'loading': 'åŠ è½½ä¸­...',
        'no_data': 'æš‚æ— æ•°æ®',

        // Users Table
        'users.title': 'ç”¨æˆ·åˆ—è¡¨',
        'users.search': 'æœç´¢é‚®ç®±æˆ–ç”¨æˆ·å...',
        'users.id': 'ID',
        'users.email': 'é‚®ç®±',
        'users.username': 'ç”¨æˆ·å',
        'users.role': 'è§’è‰²',
        'users.balance': 'ä½™é¢',
        'users.api_keys': 'API Keys',
        'users.subscriptions': 'è®¢é˜…',
        'users.status': 'çŠ¶æ€',
        'users.created_at': 'æ³¨å†Œæ—¶é—´',
        'users.no_data': 'æš‚æ— ç”¨æˆ·æ•°æ®',
        'users.load_error': 'åŠ è½½å¤±è´¥',

        // API Keys Table
        'apikeys.title': 'API Keys åˆ—è¡¨',
        'apikeys.rank': '24hæ’å',
        'apikeys.id': 'ID',
        'apikeys.name': 'åç§°',
        'apikeys.key': 'Key',
        'apikeys.user': 'ç”¨æˆ·',
        'apikeys.group': 'åˆ†ç»„',
        'apikeys.requests_24h': '24hè¯·æ±‚',
        'apikeys.cost_24h': '24hæ¶ˆè´¹',
        'apikeys.cost_7d': '7å¤©æ¶ˆè´¹',
        'apikeys.cost_total': 'æ€»æ¶ˆè´¹',
        'apikeys.total_tokens': 'æ€»Token',
        'apikeys.last_used': 'æœ€åä½¿ç”¨',
        'apikeys.status': 'çŠ¶æ€',
        'apikeys.created_at': 'åˆ›å»ºæ—¶é—´',
        'apikeys.not_used': 'æœªä½¿ç”¨',
        'apikeys.no_data': 'æš‚æ— API Keyæ•°æ®',

        // Groups Table
        'groups.title': 'åˆ†ç»„é…é¢ç®¡ç†',
        'groups.id': 'ID',
        'groups.name': 'åç§°',
        'groups.platform': 'å¹³å°',
        'groups.subscription_type': 'è®¢é˜…ç±»å‹',
        'groups.rate_multiplier': 'è´¹ç‡å€ç‡',
        'groups.daily_limit': 'æ—¥é…é¢',
        'groups.weekly_limit': 'å‘¨é…é¢',
        'groups.monthly_limit': 'æœˆé…é¢',
        'groups.api_keys': 'API Keys',
        'groups.subscriptions': 'è®¢é˜…æ•°',
        'groups.status': 'çŠ¶æ€',
        'groups.no_limit': 'æ— é™åˆ¶',
        'groups.no_data': 'æš‚æ— åˆ†ç»„æ•°æ®',

        // Subscriptions Table
        'subscriptions.title': 'è®¢é˜…ä¸é…é¢ä½¿ç”¨',
        'subscriptions.user': 'ç”¨æˆ·',
        'subscriptions.group': 'åˆ†ç»„',
        'subscriptions.daily_usage': 'æ—¥é…é¢ä½¿ç”¨',
        'subscriptions.weekly_usage': 'å‘¨é…é¢ä½¿ç”¨',
        'subscriptions.monthly_usage': 'æœˆé…é¢ä½¿ç”¨',
        'subscriptions.validity': 'æœ‰æ•ˆæœŸ',
        'subscriptions.status': 'çŠ¶æ€',
        'subscriptions.no_limit': 'æ— é™åˆ¶',
        'subscriptions.no_data': 'æš‚æ— è®¢é˜…æ•°æ®',

        // Usage Stats
        'usage.top_users': 'Top 10 ç”¨æˆ· (7å¤©)',
        'usage.top_users.user': 'ç”¨æˆ·',
        'usage.top_users.requests': 'è¯·æ±‚æ•°',
        'usage.top_users.cost': 'æ€»æ¶ˆè´¹ (USD)',
        'usage.recent': 'æœ€è¿‘è¯·æ±‚è®°å½•',
        'usage.recent.id': 'ID',
        'usage.recent.api_key': 'API Key',
        'usage.recent.user': 'ç”¨æˆ·',
        'usage.recent.model': 'æ¨¡å‹',
        'usage.recent.input_tokens': 'è¾“å…¥Token',
        'usage.recent.output_tokens': 'è¾“å‡ºToken',
        'usage.recent.cost': 'æ¶ˆè´¹',
        'usage.recent.duration': 'è€—æ—¶',
        'usage.recent.time': 'æ—¶é—´',
        'usage.no_data': 'æš‚æ— æ•°æ®',
        'usage.no_usage': 'æš‚æ— ä½¿ç”¨è®°å½•',

        // Common
        'common.requests': 'è¯·æ±‚',
        'common.users': 'ç”¨æˆ·',
        'common.keys': 'Keys',
        'common.total': 'å…±',
        'common.items': 'æ¡',

        // Status
        'status.active': 'æ´»è·ƒ',
        'status.disabled': 'å·²ç¦ç”¨',
        'status.expired': 'å·²è¿‡æœŸ',
        'status.admin': 'ç®¡ç†å‘˜',
        'status.user': 'ç”¨æˆ·'
      },
      en: {
        // Login
        'login.title': 'S2A Dashboard',
        'login.subtitle': 'Enter admin password to continue',
        'login.password.placeholder': 'Enter password',
        'login.button': 'Login',
        'login.error.wrong': 'Incorrect password, please try again',
        'login.error.network': 'Login failed, please check network connection',

        // Header
        'header.title': 'S2A Dashboard',
        'header.logout': 'Logout',
        'header.github': 'GitHub Repository',

        // Navigation
        'nav.overview': 'Overview',
        'nav.users': 'Users',
        'nav.apikeys': 'API Keys',
        'nav.groups': 'Groups',
        'nav.subscriptions': 'Subscriptions',
        'nav.usage': 'Usage',

        // Overview Stats
        'stat.total_users': 'Total Users',
        'stat.active_users': 'Active Users',
        'stat.api_keys': 'API Keys',
        'stat.groups': 'Groups',
        'stat.subscriptions': 'Active Subscriptions',
        'stat.requests_24h': '24h Requests',
        'stat.balance': 'Total Quota (USD)',

        // Overview Charts
        'chart.daily_trend': 'Last 7 Days Usage Trend',
        'chart.model_distribution': 'Model Usage Distribution',
        'loading': 'Loading...',
        'no_data': 'No data available',

        // Users Table
        'users.title': 'User List',
        'users.search': 'Search email or username...',
        'users.id': 'ID',
        'users.email': 'Email',
        'users.username': 'Username',
        'users.role': 'Role',
        'users.balance': 'Balance',
        'users.api_keys': 'API Keys',
        'users.subscriptions': 'Subscriptions',
        'users.status': 'Status',
        'users.created_at': 'Created At',
        'users.no_data': 'No users available',
        'users.load_error': 'Failed to load',

        // API Keys Table
        'apikeys.title': 'API Keys List',
        'apikeys.rank': '24h Rank',
        'apikeys.id': 'ID',
        'apikeys.name': 'Name',
        'apikeys.key': 'Key',
        'apikeys.user': 'User',
        'apikeys.group': 'Group',
        'apikeys.requests_24h': '24h Requests',
        'apikeys.cost_24h': '24h Cost',
        'apikeys.cost_7d': '7d Cost',
        'apikeys.cost_total': 'Total Cost',
        'apikeys.total_tokens': 'Total Tokens',
        'apikeys.last_used': 'Last Used',
        'apikeys.status': 'Status',
        'apikeys.created_at': 'Created At',
        'apikeys.not_used': 'Not used',
        'apikeys.no_data': 'No API keys available',

        // Groups Table
        'groups.title': 'Group Quota Management',
        'groups.id': 'ID',
        'groups.name': 'Name',
        'groups.platform': 'Platform',
        'groups.subscription_type': 'Subscription Type',
        'groups.rate_multiplier': 'Rate Multiplier',
        'groups.daily_limit': 'Daily Limit',
        'groups.weekly_limit': 'Weekly Limit',
        'groups.monthly_limit': 'Monthly Limit',
        'groups.api_keys': 'API Keys',
        'groups.subscriptions': 'Subscriptions',
        'groups.status': 'Status',
        'groups.no_limit': 'Unlimited',
        'groups.no_data': 'No groups available',

        // Subscriptions Table
        'subscriptions.title': 'Subscription & Quota Usage',
        'subscriptions.user': 'User',
        'subscriptions.group': 'Group',
        'subscriptions.daily_usage': 'Daily Usage',
        'subscriptions.weekly_usage': 'Weekly Usage',
        'subscriptions.monthly_usage': 'Monthly Usage',
        'subscriptions.validity': 'Validity Period',
        'subscriptions.status': 'Status',
        'subscriptions.no_limit': 'Unlimited',
        'subscriptions.no_data': 'No subscriptions available',

        // Usage Stats
        'usage.top_users': 'Top 10 Users (7 days)',
        'usage.top_users.user': 'User',
        'usage.top_users.requests': 'Requests',
        'usage.top_users.cost': 'Total Cost (USD)',
        'usage.recent': 'Recent Request Logs',
        'usage.recent.id': 'ID',
        'usage.recent.api_key': 'API Key',
        'usage.recent.user': 'User',
        'usage.recent.model': 'Model',
        'usage.recent.input_tokens': 'Input Tokens',
        'usage.recent.output_tokens': 'Output Tokens',
        'usage.recent.cost': 'Cost',
        'usage.recent.duration': 'Duration',
        'usage.recent.time': 'Time',
        'usage.no_data': 'No data available',
        'usage.no_usage': 'No usage logs',

        // Common
        'common.requests': 'requests',
        'common.users': 'users',
        'common.keys': 'Keys',
        'common.total': 'Total',
        'common.items': 'items',

        // Status
        'status.active': 'Active',
        'status.disabled': 'Disabled',
        'status.expired': 'Expired',
        'status.admin': 'Admin',
        'status.user': 'User'
      }
    };

    // i18n Functions
    let currentLang = 'en';

    function detectLanguage() {
      const savedLang = localStorage.getItem('language');
      if (savedLang && (savedLang === 'zh' || savedLang === 'en')) {
        return savedLang;
      }

      const browserLang = navigator.language || navigator.userLanguage;
      if (browserLang.startsWith('zh')) {
        return 'zh';
      }
      return 'en';
    }

    function t(key) {
      return translations[currentLang][key] || key;
    }

    function setLanguage(lang) {
      currentLang = lang;
      localStorage.setItem('language', lang);
      updatePageLanguage();

      // Reload current tab data to update dynamic content
      loadTabData(currentTab);
    }

    function updatePageLanguage() {
      // Update page title
      document.title = config.siteName;

      // Update all elements with data-i18n attribute
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
          el.placeholder = t(key);
        } else {
          el.textContent = t(key);
        }
      });

      // Update all elements with data-i18n-title attribute (for elements with child content like SVG)
      document.querySelectorAll('[data-i18n-title]').forEach(el => {
        const key = el.getAttribute('data-i18n-title');
        el.title = t(key);
      });

      // Update language selector selected value
      document.querySelectorAll('.lang-select').forEach(select => {
        select.value = currentLang;
      });
    }

    // State
    let currentTab = 'overview';
    let usersPage = 1;
    let apiKeysPage = 1;
    let subscriptionsPage = 1;
    let recentUsagePage = 1;

    // Check auth on page load
    async function checkAuth() {
      try {
        const res = await fetch('/api/auth/check');
        const data = await res.json();
        if (data.authenticated) {
          showDashboard();
        } else {
          // Not authenticated, show login screen
          hideInitialLoading();
        }
      } catch (err) {
        console.error('Auth check failed:', err);
        // On error, show login screen
        hideInitialLoading();
      }
    }

    // Load configuration from server
    async function loadConfig() {
      try {
        const res = await fetch('/api/config/public');
        const data = await res.json();
        if (data.title) {
          config.siteName = data.title;
          document.title = data.title;
          // Update translations
          translations.zh['login.title'] = data.title;
          translations.zh['header.title'] = data.title;
          translations.en['login.title'] = data.title;
          translations.en['header.title'] = data.title;
          // Update login title if visible
          const loginTitle = document.querySelector('.login-title');
          if (loginTitle && document.getElementById('login-container').style.display !== 'none') {
            loginTitle.textContent = data.title;
          }
        }
      } catch (err) {
        console.error('Failed to load config:', err);
        // Keep default values on error
      }
    }

    // Hide initial loading overlay
    function hideInitialLoading() {
      const loadingEl = document.getElementById('initial-loading');
      if (loadingEl) {
        loadingEl.classList.add('fade-out');
        setTimeout(() => {
          loadingEl.style.display = 'none';
        }, 300);
      }
    }

    // Login
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const password = document.getElementById('password-input').value;
      const errorEl = document.getElementById('login-error');

      try {
        const res = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password })
        });

        if (res.ok) {
          errorEl.classList.add('hidden');
          showDashboard();
        } else {
          errorEl.textContent = t('login.error.wrong');
          errorEl.classList.remove('hidden');
        }
      } catch (err) {
        errorEl.textContent = t('login.error.network');
        errorEl.classList.remove('hidden');
      }
    });

    // Logout
    document.getElementById('logout-btn').addEventListener('click', async () => {
      await fetch('/api/logout', { method: 'POST' });
      document.getElementById('dashboard').classList.remove('active');
      document.getElementById('login-screen').style.display = 'flex';
      document.getElementById('password-input').value = '';
    });

    // Show dashboard
    function showDashboard() {
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('dashboard').classList.add('active');
      hideInitialLoading();
      // Update header title with config
      const headerTitle = document.querySelector('.header-title');
      if (headerTitle) {
        headerTitle.textContent = config.siteName;
      }
      loadOverviewData();
    }

    // Tab navigation
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabId = tab.dataset.tab;

        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(`tab-${tabId}`).classList.add('active');

        currentTab = tabId;
        loadTabData(tabId);
      });
    });

    function loadTabData(tab) {
      switch (tab) {
        case 'overview': loadOverviewData(); break;
        case 'users': loadUsers(); break;
        case 'apikeys': loadApiKeys(); break;
        case 'groups': loadGroups(); break;
        case 'subscriptions': loadSubscriptions(); break;
        case 'usage': loadUsageData(); break;
      }
    }

    // Format numbers
    function formatNumber(num) {
      if (num === null || num === undefined) return '-';
      return new Intl.NumberFormat().format(num);
    }

    function formatCurrency(num) {
      if (num === null || num === undefined) return '-';
      return '$' + parseFloat(num).toFixed(4);
    }

    function formatDate(dateStr) {
      if (!dateStr) return '-';
      return new Date(dateStr).toLocaleString('zh-CN');
    }

    function formatShortDate(dateStr) {
      if (!dateStr) return '-';
      const date = new Date(dateStr);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}/${month}/${day}`;
    }

    // Load overview data
    async function loadOverviewData() {
      try {
        const [overviewRes, usageRes] = await Promise.all([
          fetch('/api/stats/overview'),
          fetch('/api/usage/stats?days=7')
        ]);

        const overview = await overviewRes.json();
        const usage = await usageRes.json();

        document.getElementById('stat-total-users').textContent = formatNumber(overview.total_users);
        document.getElementById('stat-active-users').textContent = formatNumber(overview.active_users);
        document.getElementById('stat-api-keys').textContent = formatNumber(overview.total_api_keys);
        document.getElementById('stat-groups').textContent = formatNumber(overview.total_groups);
        document.getElementById('stat-subscriptions').textContent = formatNumber(overview.active_subscriptions);
        document.getElementById('stat-requests-24h').textContent = formatNumber(overview.requests_24h);
        document.getElementById('stat-balance').textContent = '$' + Math.floor(parseFloat(overview.total_balance || 0));

        // Daily stats
        const dailyContainer = document.getElementById('daily-stats-container');
        if (usage.dailyStats && usage.dailyStats.length > 0) {
          let html = '<div style="padding: 20px;">';
          usage.dailyStats.forEach(stat => {
            html += `
              <div class="usage-item">
                <span class="usage-model">${formatShortDate(stat.date)}</span>
                <span class="usage-tokens">${formatNumber(stat.request_count)} ${t('common.requests')}</span>
                <span class="usage-tokens">${formatNumber(stat.unique_users)} ${t('common.users')}</span>
                <span class="usage-tokens">${formatNumber(stat.unique_keys)} ${t('common.keys')}</span>
                <span class="usage-cost">${formatCurrency(stat.total_cost)}</span>
              </div>
            `;
          });
          html += '</div>';
          dailyContainer.innerHTML = html;
        } else {
          dailyContainer.innerHTML = `<div class="empty-state">${t('no_data')}</div>`;
        }

        // Model stats
        const modelContainer = document.getElementById('model-stats-container');
        if (usage.modelStats && usage.modelStats.length > 0) {
          let html = '<div style="padding: 20px;">';
          usage.modelStats.forEach(stat => {
            html += `
              <div class="usage-item">
                <span class="usage-model">${stat.model}</span>
                <span class="usage-tokens">${formatNumber(stat.request_count)} ${t('common.requests')}</span>
                <span class="usage-cost">${formatCurrency(stat.total_cost)}</span>
              </div>
            `;
          });
          html += '</div>';
          modelContainer.innerHTML = html;
        } else {
          modelContainer.innerHTML = `<div class="empty-state">${t('no_data')}</div>`;
        }
      } catch (err) {
        console.error('Failed to load overview:', err);
      }
    }

    // Users
    let searchTimeout;
    document.getElementById('users-search').addEventListener('input', (e) => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        usersPage = 1;
        loadUsers();
      }, 300);
    });

    async function loadUsers() {
      const tbody = document.getElementById('users-table-body');
      const search = document.getElementById('users-search').value;

      try {
        const res = await fetch(`/api/users?page=${usersPage}&limit=20&search=${encodeURIComponent(search)}`);
        const data = await res.json();

        if (data.data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="9" class="empty-state">${t('users.no_data')}</td></tr>`;
        } else {
          tbody.innerHTML = data.data.map(user => `
            <tr>
              <td>${user.id}</td>
              <td>${user.email}</td>
              <td>${user.username || '-'}</td>
              <td><span class="badge badge-${user.role}">${t('status.' + user.role)}</span></td>
              <td>${formatCurrency(user.balance)}</td>
              <td>${user.api_key_count}</td>
              <td>${user.active_subscription_count}</td>
              <td><span class="badge badge-${user.status}">${t('status.' + user.status)}</span></td>
              <td>${formatDate(user.created_at)}</td>
            </tr>
          `).join('');
        }

        renderPagination('users', data.pagination);
      } catch (err) {
        tbody.innerHTML = `<tr><td colspan="9" class="error-message">${t('users.load_error')}</td></tr>`;
      }
    }

    // API Keys
    async function loadApiKeys() {
      const tbody = document.getElementById('apikeys-table-body');

      try {
        const res = await fetch(`/api/api-keys?page=${apiKeysPage}&limit=20`);
        const data = await res.json();

        if (data.data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="12" class="empty-state">${t('apikeys.no_data')}</td></tr>`;
        } else {
          tbody.innerHTML = data.data.map((key, index) => {
            // Calculate global rank based on page and index
            const rank = (apiKeysPage - 1) * 20 + index + 1;
            const rankBadge = rank <= 3 ?
              `<strong style="color:var(--candy-${rank === 1 ? 'pink' : rank === 2 ? 'purple' : 'blue'});font-size:16px">#${rank}</strong>` :
              `<span style="color:var(--text-secondary)">#${rank}</span>`;

            return `
            <tr>
              <td>${rankBadge}</td>
              <td>${key.name}</td>
              <td><code style="background:#f3f4f6;padding:4px 8px;border-radius:4px;font-size:12px">${key.key_masked}</code></td>
              <td>${key.user_name || '-'}</td>
              <td>${key.group_name || '-'}</td>
              <td>${formatNumber(key.requests_24h)}</td>
              <td><strong style="color:var(--candy-purple)">${formatCurrency(key.cost_24h)}</strong></td>
              <td><strong style="color:var(--candy-blue)">${formatCurrency(key.cost_7d)}</strong></td>
              <td><strong style="color:var(--candy-pink)">${formatCurrency(key.cost_total)}</strong></td>
              <td style="color:var(--text-secondary)">${formatNumber(key.total_tokens)}</td>
              <td style="color:var(--text-muted);font-size:13px">${key.last_used_at ? formatDate(key.last_used_at) : t('apikeys.not_used')}</td>
              <td><span class="badge badge-${key.status}">${t('status.' + key.status)}</span></td>
            </tr>
          `;
          }).join('');
        }

        renderPagination('apikeys', data.pagination);
      } catch (err) {
        tbody.innerHTML = `<tr><td colspan="12" class="error-message">${t('users.load_error')}</td></tr>`;
      }
    }

    // Groups
    async function loadGroups() {
      const tbody = document.getElementById('groups-table-body');

      try {
        const res = await fetch('/api/groups');
        const data = await res.json();

        if (data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="11" class="empty-state">${t('groups.no_data')}</td></tr>`;
        } else {
          tbody.innerHTML = data.map(group => `
            <tr>
              <td>${group.id}</td>
              <td><strong>${group.name}</strong></td>
              <td>${group.platform || '-'}</td>
              <td>${group.subscription_type || '-'}</td>
              <td>${parseFloat(group.rate_multiplier).toFixed(2)}x</td>
              <td>${group.daily_limit_usd ? formatCurrency(group.daily_limit_usd) : t('groups.no_limit')}</td>
              <td>${group.weekly_limit_usd ? formatCurrency(group.weekly_limit_usd) : t('groups.no_limit')}</td>
              <td>${group.monthly_limit_usd ? formatCurrency(group.monthly_limit_usd) : t('groups.no_limit')}</td>
              <td>${group.api_key_count}</td>
              <td>${group.active_subscription_count}</td>
              <td><span class="badge badge-${group.status}">${t('status.' + group.status)}</span></td>
            </tr>
          `).join('');
        }
      } catch (err) {
        tbody.innerHTML = `<tr><td colspan="11" class="error-message">${t('users.load_error')}</td></tr>`;
      }
    }

    // Subscriptions
    async function loadSubscriptions() {
      const tbody = document.getElementById('subscriptions-table-body');

      try {
        const res = await fetch(`/api/subscriptions?page=${subscriptionsPage}&limit=20`);
        const data = await res.json();

        if (data.data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="7" class="empty-state">${t('subscriptions.no_data')}</td></tr>`;
        } else {
          tbody.innerHTML = data.data.map(sub => `
            <tr>
              <td>${sub.user_email || sub.user_name || '-'}</td>
              <td><strong>${sub.group_name}</strong></td>
              <td>
                ${renderQuotaProgress(sub.daily_usage_usd, sub.daily_limit_usd, sub.daily_usage_percent)}
              </td>
              <td>
                ${renderQuotaProgress(sub.weekly_usage_usd, sub.weekly_limit_usd, sub.weekly_usage_percent)}
              </td>
              <td>
                ${renderQuotaProgress(sub.monthly_usage_usd, sub.monthly_limit_usd, sub.monthly_usage_percent)}
              </td>
              <td>${formatShortDate(sub.starts_at)} ~ ${formatShortDate(sub.expires_at)}</td>
              <td><span class="badge badge-${sub.status}">${t('status.' + sub.status)}</span></td>
            </tr>
          `).join('');
        }

        renderPagination('subscriptions', data.pagination);
      } catch (err) {
        tbody.innerHTML = `<tr><td colspan="7" class="error-message">${t('users.load_error')}</td></tr>`;
      }
    }

    function renderQuotaProgress(used, limit, percent) {
      if (!limit || limit === '0' || limit === 0) {
        return `<span style="color:var(--text-muted)">${t('subscriptions.no_limit')}</span>`;
      }

      const p = parseFloat(percent) || 0;
      let colorClass = 'low';
      if (p >= 90) colorClass = 'critical';
      else if (p >= 70) colorClass = 'high';
      else if (p >= 50) colorClass = 'medium';

      return `
        <div class="quota-info">
          <div class="quota-row">
            <span class="quota-label">${formatCurrency(used)} / ${formatCurrency(limit)}</span>
            <span class="quota-value">${p.toFixed(1)}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill ${colorClass}" style="width: ${Math.min(p, 100)}%"></div>
          </div>
        </div>
      `;
    }

    // Usage
    async function loadUsageData() {
      loadUsageStats();
      loadRecentUsage();
    }

    async function loadUsageStats() {
      try {
        const statsRes = await fetch('/api/usage/stats?days=7');
        const stats = await statsRes.json();

        // Top users
        const topUsersTbody = document.getElementById('top-users-table-body');
        if (stats.topUsers && stats.topUsers.length > 0) {
          topUsersTbody.innerHTML = stats.topUsers.map(user => `
            <tr>
              <td>${user.email || user.username || `User #${user.id}`}</td>
              <td>${formatNumber(user.request_count)}</td>
              <td>${formatCurrency(user.total_cost)}</td>
            </tr>
          `).join('');
        } else {
          topUsersTbody.innerHTML = `<tr><td colspan="3" class="empty-state">${t('usage.no_data')}</td></tr>`;
        }
      } catch (err) {
        console.error('Failed to load usage stats:', err);
      }
    }

    async function loadRecentUsage() {
      const tbody = document.getElementById('recent-usage-table-body');

      try {
        const res = await fetch(`/api/usage/recent?page=${recentUsagePage}&limit=20`);
        const data = await res.json();

        if (data.data.length === 0) {
          tbody.innerHTML = `<tr><td colspan="9" class="empty-state">${t('usage.no_usage')}</td></tr>`;
        } else {
          tbody.innerHTML = data.data.map(log => `
            <tr>
              <td>${log.id}</td>
              <td>
                <code style="background:#f3f4f6;padding:2px 6px;border-radius:4px;font-size:11px">${log.api_key_prefix || '-'}</code>
              </td>
              <td>${log.user_name || log.user_email || '-'}</td>
              <td><strong>${log.model}</strong></td>
              <td>${formatNumber(log.input_tokens)}</td>
              <td>${formatNumber(log.output_tokens)}</td>
              <td><strong style="color:var(--candy-purple)">${formatCurrency(log.total_cost)}</strong></td>
              <td style="color:var(--text-muted)">${log.duration_ms ? log.duration_ms + 'ms' : '-'}</td>
              <td style="color:var(--text-secondary);font-size:13px">${formatDate(log.created_at)}</td>
            </tr>
          `).join('');
        }

        renderPagination('recent-usage', data.pagination);
      } catch (err) {
        console.error('Failed to load recent usage:', err);
        tbody.innerHTML = `<tr><td colspan="9" class="error-message">${t('users.load_error')}</td></tr>`;
      }
    }

    // Pagination
    function renderPagination(type, pagination) {
      const container = document.getElementById(`${type}-pagination`);
      if (!pagination || pagination.totalPages <= 1) {
        container.innerHTML = '';
        return;
      }

      const { page, totalPages, total } = pagination;
      let html = `
        <button class="page-btn" onclick="changePage('${type}', ${page - 1})" ${page <= 1 ? 'disabled' : ''}>â†</button>
      `;

      for (let i = 1; i <= Math.min(totalPages, 7); i++) {
        html += `<button class="page-btn ${i === page ? 'active' : ''}" onclick="changePage('${type}', ${i})">${i}</button>`;
      }

      if (totalPages > 7) {
        html += `<span class="page-info">... ${totalPages}</span>`;
      }

      html += `
        <span class="page-info">${t('common.total')} ${total} ${t('common.items')}</span>
        <button class="page-btn" onclick="changePage('${type}', ${page + 1})" ${page >= totalPages ? 'disabled' : ''}>â†’</button>
      `;

      container.innerHTML = html;
    }

    function changePage(type, page) {
      switch (type) {
        case 'users': usersPage = page; loadUsers(); break;
        case 'apikeys': apiKeysPage = page; loadApiKeys(); break;
        case 'subscriptions': subscriptionsPage = page; loadSubscriptions(); break;
        case 'recent-usage': recentUsagePage = page; loadRecentUsage(); break;
      }
    }

    // Init
    currentLang = detectLanguage();
    updatePageLanguage();

    // Set GitHub link from config
    const githubLink = document.getElementById('github-link');
    if (githubLink) {
      githubLink.href = config.githubUrl;
    }

    // Load config and check auth
    (async () => {
      await loadConfig();
      checkAuth();
    })();

    // Update language selector text based on screen size
    function updateLangSelectorText() {
      const langSelect = document.getElementById('lang-select-header');
      if (!langSelect) return;

      const isMobile = window.innerWidth <= 768;
      const options = langSelect.querySelectorAll('option');

      options.forEach(option => {
        if (isMobile) {
          // Mobile: show only flag
          option.textContent = option.getAttribute('data-flag');
        } else {
          // Desktop: show flag + text
          option.textContent = option.getAttribute('data-text');
        }
      });
    }

    // Call on load and resize
    updateLangSelectorText();
    window.addEventListener('resize', updateLangSelectorText);
  </script>
</body>
</html>
